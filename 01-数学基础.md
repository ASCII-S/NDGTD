# 01-数学基础模块

## 模块目标
理解DGTD方法的数学原理，包括Maxwell方程组、弱形式推导、DG方法特点和数值稳定性条件。

## 1. Maxwell方程组基础

### 1.1 时域Maxwell方程组

```markdown
时域是指在时间域中分析和求解问题的方法。
在电磁仿真中：
- 时域方法：直接求解随时间变化的电磁场 E(x,y,z,t) 和 H(x,y,z,t)
- 频域方法：求解特定频率下的电磁场 E(x,y,z,ω) 和 H(x,y,z,ω)
时域Maxwell方程组描述了电磁场随时间的瞬态变化规律，能够：
- 直接观察电磁波的传播过程
- 处理宽带信号和瞬态现象
- 通过时间步进求解得到完整的时间演化
```
DGTD方法求解的是时域Maxwell方程组：

```
∂E/∂t = (1/ε)∇×H - J/ε    (1)
∂H/∂t = -(1/μ)∇×E         (2)
```

其中：
- **E**：电场强度矢量 (V/m)
- **H**：磁场强度矢量 (A/m)  
- **ε**：介电常数 (F/m)
- **μ**：磁导率 (H/m)
- **J**：电流密度 (A/m²)


### 1.2 本构关系

本构关系是描述材料电磁特性的基本方程，它建立了电磁场量之间的关系。
在均匀介质中：
- **D = εE**：电位移矢量与电场的关系
- **B = μH**：磁感应强度与磁场的关系
其中ε（介电常数）、μ（磁导率）、σ（电导率）是材料的本构参数，它们决定了材料的电磁响应特性。

在DGTD方法中，本构关系用于将Maxwell方程组中的D、B场量转换为E、H场量，从而得到可以直接求解的方程形式。不同材料具有不同的本构参数，这是实现多介质电磁仿真的基础。


### 1.3 [边界条件](./notes/01-数学基础/边界条件.md)

*边界*是指计算域的边界面，即求解区域与外部环境的分界面。

*条件*是指在这些边界面上必须满足的物理约束关系。

*为什么需要边界条件*：
- 数学完备性 - Maxwell方程组是偏微分方程组，需要边界条件才能得到唯一解
- 物理真实性 - 边界条件描述了电磁场在不同介质界面上的物理行为
- 数值稳定性 - 正确的边界条件保证数值求解的稳定性和收敛性

常见的电磁边界条件：
- **完美导体边界**：n×E = 0, n·H = 0
- **吸收边界**：PML (Perfectly Matched Layer)
- **总场散射场边界**：用于散射问题

## 2. 弱形式推导

*形式*是指数学方程的表达方式。
- *强形式*：直接的微分方程形式，如 ∂E/∂t = (1/ε)∇×H - J/ε
  - 要求解函数处处可微
  - 边界条件直接施加
  - 数值求解困难
- *弱形式*：通过积分和测试函数变换后的形式
  - 降低了对解函数光滑性的要求（只需积分存在）
  - 边界条件自然融入积分项中
  - 更适合数值方法求解
- 为什么需要弱形式：
  - 数值友好：有限元、DG等方法都基于弱形式
  - 处理不连续：允许解在某些地方不连续（如DG方法）
  - 边界处理：边界条件通过积分项自然处理

### 2.1 强形式到弱形式
将Maxwell方程组转换为弱形式，便于数值求解：

**步骤1**：选择测试函数φ(x)
**步骤2**：与方程相乘并在计算域Ω上积分
**步骤3**：应用分部积分

### 2.2 弱形式方程
对于电场方程(1)：
```
∫Ω φ(∂E/∂t)dΩ = ∫Ω φ(1/ε)∇×H dΩ - ∫Ω φ(J/ε)dΩ
```

应用分部积分：
```
∫Ω φ(∂E/∂t)dΩ = ∫Ω ∇φ·(1/ε)H dΩ - ∮∂Ω φ(1/ε)(H×n)dS - ∫Ω φ(J/ε)dΩ
```

### 2.3 数值流量
在DG方法中，单元边界的积分项是指弱形式推导过程中，通过分部积分产生的边界面上的积分。
具体来说：
- 当将强形式的微分方程转换为弱形式时，需要对 ∫Ω φ(1/ε)∇×H dΩ 进行分部积分，分部积分会产生边界项：∮∂Ω φ(1/ε)(H×n)dS
- 这个 ∮∂Ω 积分就是单元边界的积分项，其中 ∂Ω 表示单元的边界面，n 是边界面的外法向量

在DG方法中，单元边界上的积分项通过数值流量处理：
```
∮∂Ω φ(1/ε)(H×n)dS ≈ ∮∂Ω φ F^(E,H) dS
```

其中F^(E,H)是数值流量函数。

```markdown
数值流量函数 F^(E,H) 是通过以下方式获得的：
- 理论推导：
  - 从弱形式的边界积分项 ∮∂Ω φ(1/ε)(H×n)dS 出发
  - 由于DG方法允许单元间不连续，边界上的场量有两个值（左右单元）
  - 需要定义一个数值流量来近似真实的物理流量
- 构造方法：
  - 中心流量：F = (H_L + H_R)/2 × n（简单平均）
  - 迎风流量：根据波的传播方向选择上游值
  - Lax-Friedrichs流量：F = (H_L + H_R)/2 × n + α(E_L - E_R)，其中α是稳定化参数
- 实际实现：
  - 在代码中通过 CFLX 系数和邻接单元信息计算，确保数值稳定性和物理一致性。数值流量的选择直接影响DG方法的精度和稳定性。
```
## 3. 间断伽辽金(DG)方法特点

### 3.1 基本思想
- **单元间不连续**：允许场量在单元边界上不连续
- **局部基函数**：每个单元使用独立的[基函数](./notes/01-数学基础/基函数.md)
- **数值流量耦合**：通过数值流量实现单元间耦合

### 3.2 优势
1. **高阶精度**：支持高阶基函数，精度随阶数提高
2. **几何灵活性**：适应复杂几何形状
3. **并行友好**：单元间耦合较少，适合并行计算
4. **稳定性好**：通过数值流量保证数值稳定性

### 3.3 挑战
1. **计算量大**：高阶基函数增加计算复杂度
2. **内存需求高**：需要存储更多自由度
3. **时间步长限制**：[CFL条件](./notes/01-数学基础/CFL条件.md)更严格

## 4. 空间离散化

### 4.1 基函数选择
NDGTD使用Lagrange插值基函数：
- **4阶基函数**：35个插值点，适合初步计算
- **6阶基函数**：84个插值点，适合高精度计算

### 4.2 场量展开
在四面体单元K中，场量展开为：
```
E(x,t) = Σᵢ Eᵢ(t)φᵢ(x)
H(x,t) = Σᵢ Hᵢ(t)φᵢ(x)
```

其中φᵢ(x)是Lagrange基函数，Eᵢ(t)、Hᵢ(t)是时间相关的系数。

### 4.3 质量矩阵和刚度矩阵

- **质量矩阵**：Mᵢⱼ = ∫K φᵢφⱼ dΩ
- **刚度矩阵**：Sᵢⱼ = ∫K ∇φᵢ·∇φⱼ dΩ

```markdown
在有限元方法中：
- *质量矩阵* (Mass Matrix)：
  - 定义：Mᵢⱼ = ∫K φᵢφⱼ dΩ
  - 物理意义：表示基函数之间的"重叠"程度，与系统的惯性特性相关
  - 作用：在时间积分中处理时间导数项，影响波的传播特性
- *刚度矩阵* (Stiffness Matrix)：
  - 定义：Sᵢⱼ = ∫K ∇φᵢ·∇φⱼ dΩ
  - 物理意义：表示基函数梯度之间的耦合，与系统的"刚性"相关
  - 作用：处理空间导数项，影响场的空间分布和耦合
这两个矩阵是DG方法中将连续的Maxwell方程转化为离散代数方程组的关键，质量矩阵处理时间演化，刚度矩阵处理空间耦合。
```

## 5. 时间积分

### 5.1 显式时间积分
DGTD使用显式[Runge-Kutta方法](./notes/01-数学基础/Runge-Kutta方法.md)：
```
u^(n+1) = u^n + Δt Σᵢ bᵢ kᵢ
```

其中kᵢ是中间阶段的导数。

```markdown
u^n 是第n个时间步的场量向量，具体包含：
- 电场分量：Ex, Ey, Ez 在所有网格点的数值
- 磁场分量：Hx, Hy, Hz 在所有网格点的数值
即 u^n = [Ex, Ey, Ez, Hx, Hy, Hz]，表示在时刻 t^n 时所有空间位置上的电磁场数值解。
```


### 5.2 CFL稳定性条件
显式方法需要满足[CFL条件](./notes/01-数学基础/CFL条件.md)：
```
Δt ≤ CFL × h_min / (c × √3)
```

其中：
- **h_min**：最小网格尺寸
- **c**：光速
- **CFL**：Courant数，通常取0.1/NP

### 5.3 [Runge-Kutta系数](./notes/01-数学基础/Runge-Kutta方法.md#runge-kutta系数)
NDGTD支持两种RK方法：
- **5级RK**：适合一般计算
- **14级RK**：适合高精度计算

## 6. 数值流量

### 6.1 中心流量
```
F^c = (F⁺ + F⁻)/2
```

### 6.2 迎风流量
```
F^u = (F⁺ - F⁻)/2
```

### 6.3 总数值流量
```
F^ = F^c + αF^u
```

其中α是稳定化参数。

## 7. 边界条件处理

### 7.1 完美导体边界
```
n×E = 0
```

### 7.2 PML吸收边界
使用复坐标拉伸：
```
x̃ = x + (i/ω)∫₀ˣ σ(ξ)dξ
```

### 7.3 [总场散射场边界](./notes/01-数学基础/总场散射场边界.md)
将场分解为入射场和散射场：
```
E = Eⁱⁿᶜ + Eˢᶜᵃᵗ
H = Hⁱⁿᶜ + Hˢᶜᵃᵗ
```

## 8. 数值稳定性分析

### 8.1 能量稳定性
DG方法满足能量守恒：
```
d/dt ∫Ω (ε|E|² + μ|H|²)dΩ ≤ 0
```

### 8.2 [色散分析](./notes/01-数学基础/色散分析.md)
高阶DG方法具有更好的色散特性，减少数值色散误差。

### 8.3 耗散分析
数值流量引入的耗散有助于数值稳定性。

## 9. 与代码的对应关系

### 9.1 数据结构对应
- **ELEM结构**：存储单元内的场量系数
- **CFLX结构**：存储数值流量系数
- **JCB结构**：存储雅可比变换矩阵

### 9.2 算法对应
- **体积分**：NodeDgtd.cpp中的单元内部计算
- **面积分**：数值流量计算和边界条件处理
- **时间积分**：Runge-Kutta方法的实现
